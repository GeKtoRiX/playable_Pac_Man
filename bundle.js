(()=>{"use strict";function i(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.push.apply(t,o)}return t}function e(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(i){n(e,i,o[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(o,i))}))}return e}function t(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function o(i,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}function s(i,e,t){return e&&o(i.prototype,e),t&&o(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function n(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var r=document.getElementById("canvas"),l=r.getContext("2d"),a=document.querySelector(".gameScore").lastChild,c=0;r.width=450,r.height=530;var h="",p=0,y=function(){function i(e){var o=e.position;t(this,i),this.position=o,this.width=40,this.height=40}return s(i,[{key:"draw",value:function(){l.strokeStyle="blue",l.lineWidth=5,l.strokeRect(this.position.x,this.position.y,this.width,this.height)}}]),i}();n(y,"width",40),n(y,"height",40);var d=function(){function i(e){var o=e.position;t(this,i),this.position=o,this.radius=3}return s(i,[{key:"draw",value:function(){l.fillStyle="orange",l.beginPath(),l.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI,!1),l.fill(),l.closePath()}}]),i}(),u=function(){function i(e){var o=e.position;t(this,i),this.position=o,this.radius=7}return s(i,[{key:"draw",value:function(){l.fillStyle="gold",l.beginPath(),l.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI,!1),l.fill(),l.closePath()}}]),i}(),v=function(){function i(e){var o=e.position,s=e.velocity,n=e.color,r=void 0===n?"#FF6347":n;t(this,i),this.position=o,this.velocity=s,this.radius=15,this.color=r,this.prevCollisions=[],this.speed=2,this.scared=!1}return s(i,[{key:"draw",value:function(){l.fillStyle=this.scared?"blue":this.color,l.beginPath(),l.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI,!1),l.fill(),l.closePath()}},{key:"update",value:function(){this.draw(),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}},{key:"resetVelocity",value:function(){this.velocity.x=0,this.velocity.y=0}}]),i}();n(v,"speed",2);var f=function(){function i(e){var o=e.position,s=e.velocity;t(this,i),this.position=o,this.velocity=s,this.radius=15,this.radians=.75,this.openRate=.12,this.rotation=0}return s(i,[{key:"draw",value:function(){l.save(),l.translate(this.position.x,this.position.y),l.rotate(this.rotation),l.translate(-this.position.x,-this.position.y),l.fillStyle="gold",l.beginPath(),l.arc(this.position.x,this.position.y,this.radius,this.radians,2*Math.PI-this.radians,!1),l.lineTo(this.position.x,this.position.y),l.fill(),l.closePath(),l.restore()}},{key:"update",value:function(){this.draw(),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,(this.radians<0||this.radians>.75)&&(this.openRate=-this.openRate),this.radians+=this.openRate}},{key:"resetVelocity",value:function(){this.velocity.x=0,this.velocity.y=0}}]),i}(),w={w:{pressed:!1},a:{pressed:!1},s:{pressed:!1},d:{pressed:!1}},g=[],x=[],b=[],k=[new v({position:{x:6*y.width+y.width/2+5,y:y.height+y.height/2+5},velocity:{x:v.speed,y:0}}),new v({position:{x:6*y.width+y.width/2+5,y:5*y.height+y.height/2+5},velocity:{x:v.speed,y:0},color:"green"}),new v({position:{x:6*y.width+y.width/2+5,y:7*y.height+y.height/2+5},velocity:{x:v.speed,y:0},color:"yellow"})];[["-","-","-","-","-","-","-","-","-","-","-"],["-"," "," "," "," ","p"," "," "," "," ","-"],["-"," ","-"," ","-","-","-"," ","-"," ","-"],["-"," "," "," "," ","-"," "," "," "," ","-"],["-"," ","-","-","p"," ","p","-","-"," ","-"],["-"," "," "," "," ","-"," "," "," "," ","-"],["-","p","-"," ","-","-","-"," ","-","p","-"],["-"," "," "," "," ","-"," "," "," "," ","-"],["-"," ","-","-","p"," ","p","-","-"," ","-"],["-"," "," "," "," ","-"," "," "," "," ","-"],["-"," ","-"," ","-","-","-"," ","-"," ","-"],["-"," "," "," "," ","p"," "," "," "," ","-"],["-","-","-","-","-","-","-","-","-","-","-"]].forEach((function(i,e){i.forEach((function(i,t){switch(i){case"-":g.push(new y({position:{x:y.width*t+5,y:y.height*e+5}}));break;case"p":b.push(new u({position:{x:y.width*t+5+y.width/2,y:y.height*e+5+y.width/2}}));break;case" ":x.push(new d({position:{x:y.width*t+5+y.width/2,y:y.height*e+5+y.width/2}}))}}))}));var P=new f({position:{x:y.width+5+y.width/2,y:y.height+5+y.width/2},velocity:{x:0,y:0}});function O(i){var e=i.circle,t=i.rectangle,o=y.width/2-e.radius-1;return e.position.y-e.radius+e.velocity.y<=t.position.y+t.height+o&&e.position.x+e.radius+e.velocity.x>=t.position.x-o&&e.position.y+e.radius+e.velocity.y>=t.position.y-o&&e.position.x-e.radius+e.velocity.x<=t.position.x+t.width+o}!function i(){if(p=window.requestAnimationFrame(i),l.fillStyle="rgba(0, 0, 0, 0.5)",l.fillRect(0,0,r.width,r.height),0===x.length&&(console.log("Winner!"),cancelAnimationFrame(p)),w.w.pressed&&"w"===h)for(var t=0;t<g.length;t++){var o=g[t];if(O({circle:e(e({},P),{},{velocity:{x:0,y:-5}}),rectangle:o})){P.velocity.y=0;break}P.velocity.y=-5}else if(w.a.pressed&&"a"===h)for(var s=0;s<g.length;s++){var n=g[s];if(O({circle:e(e({},P),{},{velocity:{x:-5,y:0}}),rectangle:n})){P.velocity.x=0;break}P.velocity.x=-5}else if(w.s.pressed&&"s"===h)for(var y=0;y<g.length;y++){var d=g[y];if(O({circle:e(e({},P),{},{velocity:{x:0,y:5}}),rectangle:d})){P.velocity.y=0;break}P.velocity.y=5}else if(w.d.pressed&&"d"===h)for(var u=0;u<g.length;u++){var v=g[u];if(O({circle:e(e({},P),{},{velocity:{x:5,y:0}}),rectangle:v})){P.velocity.x=0;break}P.velocity.x=5}g.forEach((function(i){i.draw(),O({circle:P,rectangle:i})&&P.resetVelocity()}));for(var f=x.length-1;0<=f;f--){var C=x[f];Math.hypot(C.position.x-P.position.x,C.position.y-P.position.y)<C.radius+P.radius&&(x.splice(f,1),c+=5,a.innerHTML=c),C.draw()}for(var m=k.length-1;0<=m;m--){var j=k[m];Math.hypot(j.position.x-P.position.x,j.position.y-P.position.y)<j.radius+P.radius&&(j.scared?k.splice(m,1):(window.cancelAnimationFrame(p),console.log("Game Over")))}for(var M=b.length-1;0<=M;M--){var E=b[M];Math.hypot(E.position.x-P.position.x,E.position.y-P.position.y)<E.radius+P.radius&&(b.splice(M,1),k.forEach((function(i){i.scared=!0,setTimeout((function(){i.scared=!1}),5e3)})),c+=10,a.innerHTML=c),E.draw()}k.forEach((function(i){i.update();var t=[];if(g.forEach((function(o){!t.includes("right")&&O({circle:e(e({},i),{},{velocity:{x:i.speed,y:0}}),rectangle:o})&&t.push("right"),!t.includes("left")&&O({circle:e(e({},i),{},{velocity:{x:-i.speed,y:0}}),rectangle:o})&&t.push("left"),!t.includes("up")&&O({circle:e(e({},i),{},{velocity:{x:0,y:-i.speed}}),rectangle:o})&&t.push("up"),!t.includes("down")&&O({circle:e(e({},i),{},{velocity:{x:0,y:i.speed}}),rectangle:o})&&t.push("down")})),t.length>i.prevCollisions.length&&(i.prevCollisions=t),JSON.stringify(t)!==JSON.stringify(i.prevCollisions)){i.velocity.x>0&&!i.prevCollisions.includes("right")?i.prevCollisions.push("right"):i.velocity.x<0&&!i.prevCollisions.includes("left")?i.prevCollisions.push("left"):i.velocity.y<0&&!i.prevCollisions.includes("up")?i.prevCollisions.push("up"):i.velocity.y>0&&!i.prevCollisions.includes("down")&&i.prevCollisions.push("down"),console.log("localCurrentCol: "+t),console.log("ghostPrevCol: "+i.prevCollisions);var o=i.prevCollisions.filter((function(i){return!t.includes(i)}));console.log({pathways:o});var s=o[Math.floor(Math.random()*o.length)];switch(console.log({direction:s}),s){case"down":i.velocity.y=i.speed,i.velocity.x=0;break;case"up":i.velocity.y=-i.speed,i.velocity.x=0;break;case"right":i.velocity.x=i.speed,i.velocity.y=0;break;case"left":i.velocity.x=-i.speed,i.velocity.y=0}i.prevCollisions=[]}})),P.update(),w.w.pressed&&"w"===h?P.velocity.y=-5:w.a.pressed&&"a"===h?P.velocity.x=-5:w.s.pressed&&"s"===h?P.velocity.y=5:w.d.pressed&&"d"===h&&(P.velocity.x=5),P.velocity.x>0?P.rotation=0:P.velocity.x<0?P.rotation=Math.PI:P.velocity.y>0?P.rotation=Math.PI/2:P.velocity.y<0&&(P.rotation=-Math.PI/2)}(),window.addEventListener("keydown",(function(i){switch(i.key){case"w":w.w.pressed=!0,h="w";break;case"a":w.a.pressed=!0,h="a";break;case"s":w.s.pressed=!0,h="s";break;case"d":w.d.pressed=!0,h="d";break;default:console.log("undefined key")}console.log(P.velocity)})),window.addEventListener("keyup",(function(i){switch(i.key){case"w":w.w.pressed=!1;break;case"a":w.a.pressed=!1;break;case"s":w.s.pressed=!1;break;case"d":w.d.pressed=!1;break;default:console.log("undefined key")}}))})();